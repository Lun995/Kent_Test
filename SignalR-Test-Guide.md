# SignalR 測試頁面使用指南

## 🎯 測試頁面功能

這個測試頁面已經配置為對接您的後端 SignalR Hub 和 API Controller：

### 後端配置
- **HTTP 端口**: `http://localhost:5019`
- **HTTPS 端口**: `https://localhost:7107`
- **SignalR Hub 端點**: 
  - `/hubs/chathub` (主要聊天 Hub)
  - `/hubs/connectionuser` (用戶連線 Hub)
- **API Controller 端點**: `/api/chat`

## 🚀 測試步驟

### 1. 啟動後端服務
確保您的 C# 後端專案正在運行：
```bash
# 在後端專案目錄中
dotnet run
```

### 2. 訪問測試頁面
開啟瀏覽器訪問：`http://localhost:3000/signalr-test-page`

### 3. 連線測試
1. 輸入用戶名稱
2. 點擊「連線到 Hub」按鈕
3. 檢查連線狀態

## 📋 功能測試

### 🔗 SignalR Hub 測試

#### 基本連線
- **連線到 Hub**: 建立與 SignalR Hub 的連線
- **斷開連線**: 斷開與 Hub 的連線
- **連線狀態**: 顯示連線 ID 和狀態

#### 聊天室功能
- **加入聊天室**: 加入聊天室並通知其他用戶
- **離開聊天室**: 離開聊天室並通知其他用戶
- **發送訊息**: 發送聊天訊息給所有用戶
- **私人訊息**: 發送私人訊息給特定用戶
- **廣播訊息**: 發送廣播訊息給所有用戶
- **發送通知**: 發送通知給所有用戶

#### 用戶管理
- **線上用戶**: 查看當前線上用戶列表
- **重新整理**: 更新線上用戶列表

### 🔌 API Controller 測試

#### API 端點測試
- **測試 API 狀態**: 呼叫 `GET /api/chat/status`
- **透過 API 廣播**: 呼叫 `POST /api/chat/broadcast`
- **透過 API 發送通知**: 呼叫 `POST /api/chat/notification`

## 🎨 介面說明

### 主要區域
1. **連線設定**: Hub URL 和用戶名稱設定
2. **功能標籤頁**: 
   - 聊天室：基本聊天功能
   - API 測試：API Controller 測試
   - 線上用戶：用戶管理
3. **訊息記錄**: 即時顯示所有訊息
4. **連線狀態**: 顯示連線資訊和統計

### 訊息類型
- **聊天訊息**: 一般聊天訊息 (藍色邊框)
- **系統訊息**: 用戶加入/離開通知 (黃色邊框)
- **通知訊息**: 系統通知 (藍綠色邊框)
- **私人訊息**: 私人對話 (紅色邊框)
- **廣播訊息**: 廣播訊息 (綠色邊框)

## 🧪 測試建議

### 基本功能測試
1. **單用戶測試**
   - 連線到 Hub
   - 加入聊天室
   - 發送訊息
   - 測試通知功能

2. **多用戶測試**
   - 開啟多個瀏覽器分頁
   - 每個分頁使用不同用戶名稱
   - 測試即時通訊功能
   - 測試私人訊息

3. **API 整合測試**
   - 測試 API 狀態端點
   - 測試 API 廣播功能
   - 測試 API 通知功能

### 進階測試
1. **連線穩定性**
   - 測試斷線重連
   - 測試網路中斷恢復

2. **錯誤處理**
   - 測試無效的 Hub URL
   - 測試後端服務關閉
   - 測試 API 錯誤回應

3. **性能測試**
   - 多用戶同時連線
   - 大量訊息發送
   - 長時間連線測試

## 🔧 故障排除

### 常見問題

#### 1. 連線失敗
**症狀**: "Failed to complete negotiation with the server"
**解決方案**:
- 確認後端服務正在運行
- 檢查 Hub URL 是否正確
- 確認 CORS 設定正確

#### 2. CORS 錯誤
**症狀**: 瀏覽器顯示 CORS 錯誤
**解決方案**:
- 確認後端 CORS 設定包含 `http://localhost:3000`
- 檢查後端 CORS 設定是否允許 credentials

#### 3. API 呼叫失敗
**症狀**: API 測試按鈕無回應
**解決方案**:
- 確認 API Controller 端點正確
- 檢查 HTTP 方法是否匹配
- 確認請求格式正確

### 除錯技巧

#### 瀏覽器開發者工具
1. **Console 標籤**: 查看 SignalR 連線日誌
2. **Network 標籤**: 監控 API 請求和 WebSocket 連線
3. **Application 標籤**: 檢查 WebSocket 連線狀態

#### 後端日誌
- 查看後端控制台輸出
- 監控 Hub 連線狀態
- 檢查 API 請求日誌

## 📊 監控指標

### 連線狀態
- 連線 ID
- 連線狀態 (已連線/未連線)
- 錯誤訊息

### 訊息統計
- 訊息總數
- 通知數量
- 線上用戶數量

### API 回應
- API 狀態回應
- API 錯誤訊息
- 回應時間

## 🎯 預期結果

### 成功連線
- 顯示綠色「已連線」狀態
- 顯示連線 ID
- 可以進行聊天和 API 測試

### 聊天功能
- 訊息即時顯示
- 用戶加入/離開通知
- 私人訊息功能正常

### API 功能
- API 狀態端點正常回應
- API 廣播功能正常
- API 通知功能正常

## 📝 注意事項

1. **後端服務**: 確保後端服務在測試前已啟動
2. **端口配置**: 確認前端配置的端口與後端一致
3. **CORS 設定**: 後端需要正確配置 CORS 以允許前端連線
4. **SSL 憑證**: 開發環境可能需要忽略 SSL 憑證驗證
5. **防火牆**: 確保防火牆不會阻擋連線

這個測試頁面提供了完整的 SignalR 功能測試環境，可以全面驗證您的後端實作。
